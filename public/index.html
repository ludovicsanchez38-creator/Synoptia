<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Builder¬≥ - Synoptia</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="gradient-bg"></div>
    <header class="main-header">
        <div class="header-inner">
            <div class="logo-stack">
                <img src="/favicon.png" alt="Synoptia Logo" class="logo-img">
                <span class="logo-text">Synoptia</span>
            </div>
            <nav class="header-nav">
                <a href="#features">Fonctionnalit√©s</a>
                <a href="#generator">G√©n√©rateur</a>
                <a href="/docs" class="nav-pill">Docs API</a>
            </nav>
        </div>
        <div class="hero">
            <div class="hero-text">
                <h1>Builder¬≥</h1>
                <p>D√©cris ton besoin en fran√ßais naturel. <strong>3 agents IA collaborent</strong> pour cr√©er un workflow n8n parfait : planification (GPT-5), g√©n√©ration (GPT-5) et validation stricte (Claude Sonnet 4.5).</p>
                <div class="hero-badges">
                    <span class="badge">üß† Multi-Agent System</span>
                    <span class="badge">‚úÖ Validation Claude</span>
                    <span class="badge">üîÑ Auto-Correction</span>
                </div>
            </div>
            <div class="hero-visual">
                <img src="/images/Les 3.jpeg" alt="√âquipe d'agents IA" class="hero-team-image">
            </div>
        </div>
    </header>

    <main>
        <section id="generator" class="panel">
            <div class="panel-header">
                <h2>D√©cris ton automatisation</h2>
                <p>L'agent s√©lectionne les meilleurs triggers, pr√©pare les branches complexes et peut d√©ployer directement sur n8n.</p>
            </div>
            <div class="panel-body">
                <form id="workflow-form" class="form-grid">
                    <label class="form-block span-2">
                        <span class="label-text">Ta demande</span>
                        <textarea id="request" name="request" rows="5" placeholder="Exemple : Quand un lead signe via Typeform, enrichis mon CRM, notifie l'√©quipe et envoie un kit de bienvenue."></textarea>
                    </label>

                    <div class="form-block">
                        <span class="label-text">D√©ploiement automatique</span>
                        <label class="toggle">
                            <input type="checkbox" id="autoExecute" name="autoExecute" checked>
                            <span class="toggle-track"></span>
                            <span class="toggle-label">Envoyer directement sur n8n</span>
                        </label>
                    </div>

                    <!-- Complexit√© d√©tect√©e automatiquement -->

                    <div class="form-block span-2">
                        <span class="label-text">Inspiration rapide</span>
                        <div class="example-row" id="examples">
                            <button type="button" class="example">Synchronise HubSpot ‚Üî Google Sheets chaque nuit et poste un r√©sum√© Slack</button>
                            <button type="button" class="example">Traitement automatique des pi√®ces jointes Gmail vers Drive puis OCR</button>
                            <button type="button" class="example">Pipeline SAV : webhook entrant ‚ûù QA ‚ûù escalade √©quipe</button>
                        </div>
                    </div>

                    <div class="form-block span-2 align-end">
                        <button id="generateBtn" type="submit" class="primary-btn">G√©n√©rer le workflow</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Section 3-Agents Pipeline -->
        <section class="panel agents-panel">
            <div class="panel-header">
                <h2>Pipeline Multi-Agent</h2>
                <p>3 intelligences artificielles collaborent pour garantir la qualit√© maximale</p>
            </div>
            <div class="panel-body">
                <div class="agents-pipeline">
                    <div class="agent-card" id="agent-planning">
                        <img src="/images/EL PLANIFICATOR.jpeg" alt="El Planificator" class="agent-avatar">
                        <h3>El Planificator</h3>
                        <div class="agent-model">GPT-5</div>
                        <p>Analyse la demande et planifie l'architecture du workflow</p>
                        <div class="agent-tasks">
                            <div class="agent-tasks-header" onclick="toggleTasksList(this)">
                                <span class="tasks-count">0 t√¢che</span>
                                <span class="tasks-toggle">‚ñº</span>
                            </div>
                            <ul class="agent-tasks-list collapsed"></ul>
                        </div>
                        <div class="agent-status" data-status="idle">
                            <span class="status-dot"></span>
                            <span class="status-text">En attente</span>
                        </div>
                        <div class="agent-cost" id="cost-planning" style="display: none;">
                            üí∞ <span class="cost-amount">0.00‚Ç¨</span>
                        </div>
                    </div>

                    <div class="pipeline-arrow">‚Üí</div>

                    <div class="agent-card" id="agent-generator">
                        <img src="/images/EL GENERATOR.jpeg" alt="El Generator" class="agent-avatar">
                        <h3>El Generator</h3>
                        <div class="agent-model">GPT-5</div>
                        <p>G√©n√®re le workflow JSON avec les nodes valid√©s</p>
                        <div class="agent-tasks">
                            <div class="agent-tasks-header" onclick="toggleTasksList(this)">
                                <span class="tasks-count">0 t√¢che</span>
                                <span class="tasks-toggle">‚ñº</span>
                            </div>
                            <ul class="agent-tasks-list collapsed"></ul>
                        </div>
                        <div class="agent-status" data-status="idle">
                            <span class="status-dot"></span>
                            <span class="status-text">En attente</span>
                        </div>
                        <div class="agent-cost" id="cost-generator" style="display: none;">
                            üí∞ <span class="cost-amount">0.00‚Ç¨</span>
                        </div>
                    </div>

                    <div class="pipeline-arrow">‚Üí</div>

                    <div class="agent-card" id="agent-supervisor">
                        <img src="/images/EL SUPERVISOR.jpeg" alt="El Supervisor" class="agent-avatar">
                        <h3>El Supervisor</h3>
                        <div class="agent-model">Claude Sonnet 4.5</div>
                        <p>Valide strictement et relance si n√©cessaire</p>
                        <div class="agent-tasks">
                            <div class="agent-tasks-header" onclick="toggleTasksList(this)">
                                <span class="tasks-count">0 t√¢che</span>
                                <span class="tasks-toggle">‚ñº</span>
                            </div>
                            <ul class="agent-tasks-list collapsed"></ul>
                        </div>
                        <div class="agent-status" data-status="idle">
                            <span class="status-dot"></span>
                            <span class="status-text">En attente</span>
                        </div>
                        <div class="agent-cost" id="cost-supervisor" style="display: none;">
                            üí∞ <span class="cost-amount">0.00‚Ç¨</span>
                        </div>
                    </div>
                </div>

                <!-- Co√ªt total du workflow -->
                <div class="workflow-total-cost" id="workflow-total-cost" style="display: none; margin-top: 24px; padding: 16px; background: rgba(91, 124, 250, 0.1); border: 1px solid rgba(91, 124, 250, 0.3); border-radius: 12px; text-align: center;">
                    <div style="font-size: 14px; color: #94a3b8; margin-bottom: 4px;">Co√ªt total du workflow</div>
                    <div style="font-size: 24px; font-weight: 700; color: #38bdf8;">
                        üí∞ <span id="total-cost-amount">0.00‚Ç¨</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Panneau de Raisonnement en temps r√©el -->
        <section class="panel reasoning-panel hidden" id="reasoning-panel">
            <div class="panel-header">
                <h2>üß† Raisonnement en cours...</h2>
                <div class="reasoning-timer" id="reasoning-timer">
                    <span class="timer-icon">‚è±Ô∏è</span>
                    <span class="timer-text" id="timer-text">0s</span>
                </div>
            </div>
            <div class="current-task" id="current-task" style="padding: 12px 24px; background: rgba(91, 124, 250, 0.1); border-left: 3px solid #5b7cfa; margin: 0 24px 16px; border-radius: 4px; display: none;">
                <strong>T√¢che en cours :</strong> <span id="current-task-text">Initialisation...</span>
            </div>
            <div class="panel-body">
                <div class="reasoning-container">
                    <div class="reasoning-steps" id="reasoning-steps">
                        <!-- Les √©tapes appara√Ætront ici en temps r√©el -->
                    </div>
                    <div class="reasoning-progress">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="panel" id="results-panel">
            <div class="panel-header split">
                <div>
                    <h2>R√©sultat</h2>
                    <p>Workflow g√©n√©r√© et valid√© par l'√©quipe d'agents</p>
                </div>
                <div class="status-pill" id="status-pill">En attente</div>
            </div>
            <div class="panel-body results-body">
                <div class="placeholder" id="placeholder">
                    <div class="placeholder-icon">‚öôÔ∏è</div>
                    <p>Remplis le formulaire pour lancer la g√©n√©ration.</p>
                </div>

                <div class="results-grid hidden" id="results-grid">
                    <article class="result-card">
                        <h3>Workflow</h3>
                        <dl>
                            <div>
                                <dt>Nom</dt>
                                <dd id="workflow-name">‚Äî</dd>
                            </div>
                            <div>
                                <dt>Description</dt>
                                <dd id="workflow-description">‚Äî</dd>
                            </div>
                            <div>
                                <dt>Nombre de n≈ìuds</dt>
                                <dd id="workflow-nodes">‚Äî</dd>
                            </div>
                        </dl>
                    </article>

                    <article class="result-card">
                        <h3>Analyse IA</h3>
                        <ul class="analysis-list" id="analysis-list"></ul>
                    </article>

                    <article class="result-card">
                        <h3>D√©ploiement</h3>
                        <div id="deployment-info" class="deployment-info">
                            <p>Non lanc√©</p>
                        </div>
                        <button id="copy-json" class="secondary-btn" type="button">Copier le JSON</button>
                    </article>
                </div>
            </div>
        </section>

        <section id="features" class="feature-panel">
            <h2>Pourquoi Synoptia</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <h3>Branchements intelligents</h3>
                    <p>Split-batches, conditions QA et consolidation automatique pour des sc√©narios tr√®s complexes.</p>
                </div>
                <div class="feature-card">
                    <h3>Stack unifi√©e</h3>
                    <p>Int√©grations natives HubSpot, Sheets, Slack, PostgreSQL, Drive et HTTP personnalis√©s.</p>
                </div>
                <div class="feature-card">
                    <h3>Ready to deploy</h3>
                    <p>Export JSON pr√™t pour n8n ou d√©ploiement direct via l'API avec monitoring.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <p>¬© Synoptia 2024 ‚Äî Automatisation haute couture.</p>
        <div class="footer-links">
            <a href="mailto:ludo@synoptia.fr">Contact</a>
            <a href="https://discord.gg/synoptia" target="_blank" rel="noreferrer">Communaut√©</a>
        </div>
    </footer>

    <div class="toast" id="toast"></div>

    <!-- FIX #1: Charger la fonction toggleTasksList AVANT app.js pour √©viter race condition -->
    <script>
        // Fonction GLOBALE pour toggle - D√©finie AVANT le chargement de app.js
        window.toggleTasksList = function(header) {
            console.log('üî• toggleTasksList called!', header);
            const tasksList = header.parentElement.querySelector('.agent-tasks-list');
            if (tasksList) {
                tasksList.classList.toggle('collapsed');
                const toggle = header.querySelector('.tasks-toggle');
                if (toggle) {
                    toggle.textContent = tasksList.classList.contains('collapsed') ? '‚ñº' : '‚ñ≤';
                }
                console.log('‚úÖ Toggle executed! Collapsed:', tasksList.classList.contains('collapsed'));
            } else {
                console.error('‚ùå tasksList not found');
            }
        };
    </script>

    <script src="app.js"></script>
</body>
</html>
